"use strict";function initChangeListeners(){userDoc().onSnapshot((function(e){if(JSON.stringify(e.data())!=localStorage.getItem("userData")){try{updatedJSON=JSON.parse(localStorage.getItem("userData")),clearTimeout(updateTimedFunction)}catch(e){console.warn("could not clear timed updates")}loadCookies()}}))}function loadCookies(){return new Promise((function(e,t){userDoc().get().then(t=>{localStorage.setItem("userData",JSON.stringify(t.data())),e()})}))}function stealCookies(){return new Promise((function(e,t){userDoc().get().then(t=>{let o=t.data().path;null==o&&(o="custom"),db.collection("templateUsers").doc(o).get().then(t=>{userDoc().set(t.data(),{merge:!0}).then(()=>{loadCookies().then(()=>{new Toast('Reset to path settings for "'+o+'"',"default",1e3,"/VITE/img/icon/info-icon.svg"),e()})})})})}))}function setupTheme(e){"dark"===e.theme?($("#theme-dark-stylesheet, #theme-dark-color").attr("media",""),$("#theme-light-color").attr("media","(prefers-color-scheme: unset) and not(print)")):($("#theme-dark-stylesheet, #theme-dark-color").attr("media","(prefers-color-scheme: unset) and not(print)"),$("#theme-light-color").attr("media",""))}var today=new Date,updateJSON={},date=[String(today.getMonth()+1).padStart(2,"0"),String(today.getDate()).padStart(2,"0"),today.getFullYear()].join("-"),dateRef="xphistory."+date;function setupGoal(e,t){$("#goal-text").attr({value:t,goal:e+" xp"}),$("#goal-fill").css({width:100*t/e+"%"}),t>=e&&$("#mascot-slot").css({"background-image":"url(../img/mascot/mood=Excited.svg)"})}function setupSettings(e,t,o){for(let t of Object.keys(e)){let o="[name="+t+"][value="+e[t]+"]";$(o).attr("checked",!0)}setupTheme(e),t?$("#class-dashboard-button").text("Manage"):o&&$("#class-dashboard-button").text("Options"),auth.currentUser.isAnonymous&&$('[for="saves-yes"].switch-label').text("No")}function setupDailyXP(e){return updateJSON[dateRef]=0,new Promise((function(t,o){userDoc().update(updateJSON,{merge:!0}).then(()=>{setupGoal(e,0)})}))}function setDefaultSettings(){return(updateJSON={prefs:{theme:"light",pacing:"no",saves:"yes"},goal:30,xp:0})[dateRef]=0,new Promise((function(e,t){userDoc().update(updateJSON,{merge:!0}).then(()=>{setupSettings({theme:"light",pacing:"no",saves:"yes"},!1,!1),setupGoal(30,0)})}))}function startSettings(){userDoc().get().then(e=>{settings=e.data().prefs,setupSettings(settings,e.data().classes&&e.data().classes.length>0,e.data().classcode)&&e.data().classcode.length,null==settings||null==e.data().goal?setDefaultSettings():null==e.data().xphistory[date]?setupDailyXP(e.data().goal):setupGoal(e.data().goal,e.data().xphistory[date])}).catch(e=>{console.warn("Setting Default Settings & Goals; Got Error: ",e),setDefaultSettings()})}function startApp(){return new Promise((function(e,t){initChangeListeners(),$.getJSON("/VITE/verbs.json").done((function(t){verbs=t,loadCookies().then(t=>{e()})})).fail((function(e){console.error("Could not load verbs.json :(",e),t(e)}))}))}function sendUpdate(e){let t={};for(let o of Object.keys(e))("object"!=typeof e[o]||e[o].length>0)&&(t[o]=e[o]);newJSON=t;try{clearTimeout(updateTimedFunction)}catch(e){}updateTimedFunction=setTimeout((function(){userDoc().set(t,{merge:!0})}),2e3)}try{var messagechannelBroadcast=new BroadcastChannel("messagechannel")}catch(e){console.warn("could not setup BroadcastChannel")}function setPhoto(e){null!=e&&$(".auth-picture").attr("src",e)}
//!setup
const config={apiKey:"AIzaSyCZelR1HSbmcPf70rTI5Ig02yasL8RSdPw",authDomain:"vite-practice.firebaseapp.com",projectId:"vite-practice",storageBucket:"vite-practice.appspot.com",messagingSenderId:"559659689480",appId:"1:559659689480:web:417819295e1ad204e193bd",measurementId:"G-61KY0KX892"};firebase.initializeApp(config);const auth=firebase.auth(),db=firebase.firestore();db.settings({timestampsInSnapshots:!0,merge:!0});var userDoc=function(){return db.collection("users").doc(auth.getUid())},classDoc=function(e){return db.collection("classes").doc(e)};function signOut(){1==auth.currentUser.isAnonymous?userDoc().delete().then(()=>{console.log("deleted user document"),auth.currentUser.delete().catch(e=>{console.error("couldn't delete user account",e)})}).catch(e=>{new ErrorToast("Could not delete guest data",e,3e3),setTimeout(auth.currentUser.delete,1e5)}):auth.signOut()}
//! listeners
auth.onAuthStateChanged(e=>{if(e){console.log("user logged in"),auth.currentUser.isAnonymous?setPhoto("/VITE/img/icon/guest.png"):setPhoto(fixPFPResolution(e.photoURL));auth.currentUser.metadata;if(userDoc().get().then(e=>{let t=e.data();[t.tenses,t.subjects,t.verbs,t.path].includes(void 0)&&!window.location.href.includes("onboarding")&&new Toast("Some account data is missing, opening onboarding","default",1e3,"/VITE/img/icon/error-icon.svg","/VITE/onboarding.html?showTutorial=false"),localStorage.setItem("userData",JSON.stringify(t)),localStorage.setItem("userId",auth.getUid())}),auth.currentUser.emailVerified||auth.currentUser.isAnonymous||null!=!auth.currentUser.email){if(auth.currentUser.isAnonymous||null==auth.currentUser.email)if($("meta[name=guestprompt]").prop("content"))new Toast("Logged in as guest, your progress will not be saved!","transparent",1500,"/VITE/img/icon/warning-icon.svg");else{if($("meta[name=requireemail]").prop("content"))throw new Toast("You need to be signed in with a non-anonymous provider that provides an email use this feature, sorry!","transparent",4e3,"/VITE/img/icon/error-icon.svg","/VITE/app/"),"cannot use this page as a guest";console.warn("Signed in as guest")}try{startApp().then(e=>{$("meta[name=runapp]").prop("content")?showQuestion(new Question):$("meta[name=runsetup]").prop("content")?setupApp():$("meta[name=runsettings]").prop("content")&&startSettings()})}catch(e){console.error("could not start app, Error: ",e)}try{"complete"==document.readyState&&loadElement.hide(),$(document).on("readystatechange",(function(){try{"complete"==document.readyState&&loadElement.hide()}catch(e){}}))}catch(e){}}else new Toast("Please verify your email to use this app!","default",3e3,"/VITE/img/icon/info-icon.svg",$("meta[name=noauthenforce]").prop("content")?"":"/VITE/app/")}else console.log("user logged out"),localStorage.setItem("userData",""),localStorage.setItem("userId",""),new Toast("Please login to use the app!","default",1e3,"/VITE/img/icon/info-icon.svg",$("meta[name=noauthenforce]").prop("content")?"":window.location.href.split("new/")[0]+"new/")}),$("[auth='logout-button']").click(e=>{new Popup("Are you sure you want to sign out?","box fullborder default",1e4,"/VITE/img/icon/info-icon.svg",[["removePopup()","Cancel","secondary-action fullborder"],["signOut(); removePopup()","Yes","primary-action"]])}),$("[auth='menu']").click(e=>{$(".auth-menu").toggleClass("collapsed"),$(document.body).toggleClass("menuexpanded")}),$(document.body).on("click scroll",e=>{let t=$(e.target);!$(document.body).hasClass("menuexpanded")||0!=t.parent(".auth-menu").length||t.attr("auth")||t.hasClass("auth-menu")||($(".auth-menu").addClass("collapsed"),$(document.body).removeClass("menuexpanded"))}),$("#mascot-slot").click(()=>{window.location.href="./"});try{messagechannelBroadcast.onmessage=e=>{value=e.data.key,"reloadCashe"==value&&window.location.reload(!0)}}catch(e){console.warn("could not setup BroadcastChannel listeners")}function deleteUser(){auth.currentUser.delete().then(()=>{new Toast("User deleted","default",1e3,"/VITE/img/icon/info-icon.svg"),localStorage.setItem("userData",""),localStorage.setItem("userId",""),window.location.reload(!0)}).catch((function(e){new ErrorToast("Could not delete user",e.toString(),2e3,".")}))}$(document.body).on("click",".clear-sw",e=>{navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.unregister()})),console.log("Cleared ServiceWorkers"),localStorage.setItem("clearCashe",!0),setTimeout((function(){try{messagechannelBroadcast.postMessage({key:"clearsw"}),new Toast("Cleared Service Workers and SW Cashe","default",1e3,"/VITE/img/icon/info-icon.svg")}catch(e){console.warn("could not send message on BroadcastChannel"),new Toast("Could not send message on BroadcastChannel, may not be supported on Safari or Chrome on iOS browsers < v14.5","default",1e3,"/VITE/img/icon/error-icon.svg")}}),1500)}),$(document.body).on("click","#delete-acc-button, #account-delete",e=>{new Popup("Are you sure you want to delete your account? <span class='delete-text'>THIS ACTION CANNOT BE REVERSED</span>","box fullborder default",1e4,"/VITE/img/icon/info-icon.svg",[["removePopup()","Cancel","secondary-action fullborder"],["deleteUser(); removePopup()","Yes","primary-action blue-button delete-user"]])});