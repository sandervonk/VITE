"use strict";var params=new URLSearchParams(window.location.search);window.history&&history.replaceState({},"",window.location.href.substr(0,window.location.href.length-window.location.search.length)),params.set("home_page",window.location.href.split("/VITE")[0]+"/VITE");var verbs={},lastMousePos={x:0,y:0};function closeContextMenu(){$(document.body).removeAttr("contextmenu"),$(".context-menu, .context-overlay").addClass("close"),setTimeout((function(){$(".context-menu, .context-overlay").remove()}),200),$(document.body).children("[tabindex]").removeAttr("tabindex")}$(window).on("touchdown touchstart touchstop click",(function(t){lastMousePos=function(t){let e,n;return t.clientX&&t.clientY?(e=t.clientX,n=t.clientY):t.touches&&t.touches[0]?(e=t.touches[0].clientX,n=t.touches[0].clientY):t.originalEvent&&t.originalEvent.changedTouches[0]&&(e=t.originalEvent.changedTouches[0].clientX,n=t.originalEvent.changedTouches[0].clientY),{x:e,y:n}}})),"false"!=$("meta[name='docontextmenu']").attr("content")&&$(document).on("contextmenu"+(navigator&&(navigator.userAgent.match(/iPhone|iPad|iPod/i)&&CSS.supports("-webkit-touch-callout: none"))?" long-press":""),(function(t){t.preventDefault(),t.clientX==t.clientY==1&&(t.clientX=lastMousePos.x,t.clientY=lastMousePos.y);try{t.target=document.elementFromPoint(t.clientX,t.clientY)}catch(t){console.warn("could not get elementFromPoint",t)}if(!$(t.target).hasClass("context-overlay")||window.matchMedia("(min-width: 50px)").matches){$(".context-menu, .context-overlay").remove(),t.target=document.elementFromPoint(t.clientX,t.clientY);let e=$("meta[name='cm-options']").attr("content"),n=$(t.target).attr("cm-options");e=null!=e?e+",":"",e=n?e+n:e;try{e="undefined"!=e?JSON.parse("["+e+"]"):e}catch(t){console.warn("Something went wrong applying context menu options from the <meta> tag!\n\n",e,"\n\n",t),e=[]}new ContextMenu(t,this,e,{width:300,extras_callback:function(){try{let t=getCMOptions();return t||!1}catch(t){return console.warn("Could not run getCMOptions()","\n\n",t),!1}}})}})),$(window).on("click","body[contextmenu] > *:not(.context-menu)",closeContextMenu),$(document).on("click",".context-overlay",closeContextMenu),$(window).on("keydown blur resize",(function(t){"Escape"!==t.key&&t.key||(t.preventDefault(),closeContextMenu())})),$(window).on("keydown",(function(t){if($(".context-menu").length)if("Enter"===t.key&&$(".context-menu .cm-item:focus").length)t.preventDefault(),$(".context-menu .cm-item:focus").click();else if(t.key.includes("Arrow")&&$(".context-menu .cm-item:focus").length){t.preventDefault();let e=$(".context-menu .cm-item:focus"),n=t.key.replace("Arrow",""),o=$(`.context-menu .cm-item[tabindex="${parseInt(e.attr("tabindex"))+1}"]`),i=$(`.context-menu .cm-item[tabindex="${parseInt(e.attr("tabindex"))-1}"]`),a={};"Up"==n&&i.length&&!e.parent().is(i.parent())?a=i.parent().children().first():"Down"==n&&o.length&&"cm-buttons"==o.parent().attr("id")?a=$("#cm-scrollable").children().first().children().first():"Down"==n||"Right"==n?a=o:"Up"!=n&&"Left"!=n||(a=i),a.length&&a.focus()}else"Tab"===t.key&&$(".context-menu").length&&(0==$("*:focus").closest(".context-menu").length||$(".context-menu > #cm-scrollable > #cm-default-items > :last-child:focus").length)&&(t.preventDefault(),$(".context-menu .cm-item").first().focus())}));class ContextMenu{constructor(t,e,n=[],o={width:300}){if(this.defaults=[{icon:"cm-home",text:"Go to home",onclick:`window.location.href = "${params.get("home_page")}/app"`,button:!0},{icon:"cm-back",text:"Go back a page",onclick:"window.history.go(-1)",button:!0},{icon:"cm-link",text:"Copy link to this page",onclick:`copyToClipboard("${window.location.href}", closeContextMenu)`,button:!0},{icon:"cm-share",text:"Share this page",onclick:"sharePage(closeContextMenu)",button:!0},{icon:"cm-close",text:"Use system menu",onclick:'$(document).off("contextmenu long-press");closeContextMenu();'}],this.options=o,this.windowPadding=10,this.menuItems=n,o.extras_callback){let t=o.extras_callback();t.length&&(this.menuItems=this.menuItems.concat(t))}[this.x,this.y]=[t.clientX,t.clientY],this.build(this.x,this.y)}makeMenuItem(t){return $(`<div class='cm-item' onclick='${t.onclick?t.onclick:""}'><img class='cm-icon' src='/VITE/img/icon/cm/${t.icon}.svg' /><span>${t.text}</span></div>`)}makeMenuButton(t){return $(`<div class='cm-item cm-button' title='${t.text}' onclick='${t.onclick?t.onclick:""}'><img class='cm-icon' src='/VITE/img/icon/cm/${t.icon}.svg'/></div>`)}build(t,e){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.menu=$("<div class='context-menu'></div>"),this.menu.css({top:e,left:t,width:this.options.width?this.options.width:""}),this.actionButtons=$("<div id='cm-buttons'></div>"),this.defaults.forEach((t=>{t.button&&this.actionButtons.append(this.makeMenuButton(t))})),this.pageItems=$("<div id='cm-page-items'></div>"),this.menuItems.forEach((t=>{t.button?this.actionButtons.append(this.makeMenuButton(t)):this.pageItems.append(this.makeMenuItem(t))})),this.defaultItems=$("<div id='cm-default-items'><hr class='cm-separator' /></div>"),this.defaults.forEach((t=>{t.button||this.defaultItems.append(this.makeMenuItem(t))})),this.scrollableItems=$("<div id='cm-scrollable'></div>"),this.scrollableItems.append(this.pageItems,this.defaultItems),$(this.menu).append(this.actionButtons,this.scrollableItems),$(document.body).append("<div class='context-overlay'></div>",this.menu),$(document.body).attr("contextmenu",""),this.realign(t,e),$(".context-menu .cm-item").each((function(t){$(this).attr("tabindex",t+1)})),$(".context-menu .cm-item").first().focus()}realign(t,e){this.menu.focus(),this.menu.focusin(),this.menu.css({top:Math.max(this.windowPadding,Math.min(e,$(window).height()-this.menu.outerHeight()-this.windowPadding)),left:Math.max(this.windowPadding,Math.min(t,$(window).width()-this.menu.outerWidth()-this.windowPadding)),"transform-origin":`${this.x-Math.max(this.windowPadding,Math.min(t,$(window).width()-this.menu.outerWidth()-this.windowPadding))}px ${this.y-Math.max(this.windowPadding,Math.min(e,$(window).height()-this.menu.outerHeight()-this.windowPadding))}px`}),$("#cm-page-items:empty").length&&$(".context-menu").css("height","fit-content")}}class LoadCover{constructor(){try{$("meta[name=waitforload]").prop("content")&&$(".loadcover").length<1&&$(document.body).append('<div class="loadcover" style="z-index: 1000;"></div>')}catch(t){console.warn("could not setup loading animation, error:",t)}}hide(){$(".loadcover").addClass("hide"),this.removeTheme(),removeTimer()}remove(){this.hide(),$(".loadcover").remove(),removeTimer()}removeTheme(){$(".theme-load-color").remove(),removeTimer()}removeTimer(){try{clearTimeout(this.timeoutId)}catch(t){console.warn("No timeout to cancel:",t)}}}class Toast{constructor(t,e,n,o="",i=""){this.message=t,this.type=e,this.duration=n,this.icon=o,this.action=i,this.showToast()}showToast(){$(".toast").remove();let t=document.createElement("div"),e=document.createElement("div");e.classList.add("toast"),t.classList.add("toast-overlay"),e.classList.add(this.type),""!=this.icon&&(e.innerHTML+=`<img src="${this.icon}" class="toast-icon" alt="Toast Popup Icon">`),e.innerHTML+=this.message,""!=this.action&&document.body.appendChild(t),document.body.appendChild(e),setTimeout((()=>{$(e).css({animation:"slideOut 0.5s forwards"})}),this.duration),setTimeout((()=>{t.remove(),e.remove(),""!=this.action&&""!=this.action&&(window.location.href=this.action)}),this.duration+500)}}class ErrorToast extends Toast{constructor(t,e,n,o=""){super(t+=": "+e,"default",n,"/VITE/img/icon/error-icon.svg",o)}}class Popup{constructor(t,e,n,o="",i=""){"object"==typeof t?(this.title=t[0],this.message=t[1]):this.message=t,this.type=e,this.duration=n,this.icon=o,this.action=i,this.showPopup()}showPopup(){$(".popup, .popup-overlay").remove();let t=$("<div></div>",{class:"popup-overlay "+this.type}),e=$("<div></div>",{class:"popup"}),n=$("<div></div>",{id:"popup-buttons"});for(let t of this.action)$("<button></button>",{class:"popup-button "+(t[2]?t[2]:""),onclick:t[0],text:t[1]}).appendTo(n);this.icon&&$("<img alt='icon'>",{src:this.icon,class:"popup-icon",alt:"Popup Icon"}).appendTo(e),this.title&&$("<div></div>",{text:this.title,class:"popup-title"}).appendTo(e),$("<div></div>",{text:this.message,class:"popup-text"}).appendTo(e),n.appendTo(e),this.action&&t.appendTo(document.body),e.appendTo(document.body),setTimeout((()=>{$(e).css({animation:"popupout 0.25s forwards"}),$(t).css({animation:"fadeout 0.5s forwards"})}),this.duration),setTimeout((()=>{e.remove(),t.remove()}),this.duration+500)}}function removePopup(){$(".popup").css({animation:"popupout 0.25s forwards"}),$(".popup-overlay").css({animation:"fadeout 0.5s forwards"}),setTimeout((()=>{$(".popup").remove(),$(".popup-overlay").remove()}),500)}$(document.body).on("click",".popup-overlay",(function(){removePopup()}));var loadElement=new LoadCover;function copyToClipboard(t,e=function(){}){navigator.clipboard.writeText(t).then((t=>{new Toast("Copied link code to clipboard","transparent",750,"/VITE/img/icon/clipboard-icon.svg"),e()})).catch((t=>{new ErrorToast("Couldn't copy the link, sorry!"+t.toString(),2e3)}))}function getDefaultPageData(){return{title:$("meta[name='og:description']").attr("content")?$("meta[name='og:description']").attr("content"):"Conjugate French verbs, learn new tenses, or practice existing ones, all 100% free with VITE! French tools!",description:$("meta[name='og:site_name']").attr("content")?$("meta[name='og:site_name']").attr("content"):document.title,url:$("meta[name='og:url']").attr("content")?$("meta[name='og:url']").attr("content"):window.location.href}}function sharePage(t=function(){}){navigator.share(getDefaultPageData()).then((e=>{new Toast("Opened share options!","transparent",750,"/VITE/img/icon/clipboard-icon.svg"),t()})).catch((t=>{new ErrorToast("Couldn't open share options, sorry!"+t.toString(),2e3)}))}function fixPFPResolution(t){try{return t.replace("=s96-c","=s100-c")}catch(e){return t}}function setupTheme(t){try{t&&"dark"==t.theme||"dark"==JSON.parse(localStorage.userData).prefs.theme?($("#theme-dark-stylesheet, #theme-dark-color").attr("media","not print"),$("#theme-light-color, #theme-light-stylesheet").attr("media","(prefers-color-scheme: unset) and not(print)")):($("#theme-light-stylesheet, #theme-light-color").attr("media","not print"),$("#theme-dark-color, #theme-dark-stylesheet").attr("media","(prefers-color-scheme: unset) and not(print)"))}catch(t){console.warn("Couldn't Set Theme: \n\n",t)}}$("[placeholdaction]").click((function(){new Toast("This feature hasn't been implemented yet, sorry! 🤫","default",1500,"/VITE/img/icon/concern-icon.svg")})),setupTheme(),function(t,e){var n=null,o="PointerEvent"in t||t.navigator&&"msPointerEnabled"in t.navigator,i="ontouchstart"in t||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,a=o?"pointerdown":i?"touchstart":"mousedown",s=o?"pointerup":i?"touchend":"mouseup",c=o?"pointermove":i?"touchmove":"mousemove",r=0,m=0;function l(t){d(),t=function(t){return void 0!==t.changedTouches?t.changedTouches[0]:t}(t),this.dispatchEvent(new CustomEvent("long-press",{bubbles:!0,cancelable:!0,detail:{clientX:t.clientX,clientY:t.clientY},clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY}))||e.addEventListener("click",(function t(n){e.removeEventListener("click",t,!0),function(t){t.stopImmediatePropagation(),t.preventDefault(),t.stopPropagation()}(n)}),!0)}function u(o){d(o);var i=o.target,a=parseInt(function(t,n,o){for(;t&&t!==e.documentElement;){var i=t.getAttribute("data-long-press-delay");if(i)return i;t=t.parentNode}return"1000"}(i),10);n=function(e,n){if(!(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame&&t.mozCancelRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame))return t.setTimeout(e,n);var o=(new Date).getTime(),i={},a=function(){(new Date).getTime()-o>=n?e.call():i.value=requestAnimFrame(a)};return i.value=requestAnimFrame(a),i}(l.bind(i,o),a)}function d(e){var o;(o=n)&&(t.cancelAnimationFrame?t.cancelAnimationFrame(o.value):t.webkitCancelAnimationFrame?t.webkitCancelAnimationFrame(o.value):t.webkitCancelRequestAnimationFrame?t.webkitCancelRequestAnimationFrame(o.value):t.mozCancelRequestAnimationFrame?t.mozCancelRequestAnimationFrame(o.value):t.oCancelRequestAnimationFrame?t.oCancelRequestAnimationFrame(o.value):t.msCancelRequestAnimationFrame?t.msCancelRequestAnimationFrame(o.value):clearTimeout(o)),n=null}"function"!=typeof t.CustomEvent&&(t.CustomEvent=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var o=e.createEvent("CustomEvent");return o.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),o},t.CustomEvent.prototype=t.Event.prototype),t.requestAnimFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},e.addEventListener(s,d,!0),e.addEventListener(c,(function(t){var e=Math.abs(r-t.clientX),n=Math.abs(m-t.clientY);(e>=10||n>=10)&&d()}),!0),e.addEventListener("wheel",d,!0),e.addEventListener("scroll",d,!0),e.addEventListener(a,(function(t){r=t.clientX,m=t.clientY,u(t)}),!0)}(window,document);
